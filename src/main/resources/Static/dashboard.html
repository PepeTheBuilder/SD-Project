<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
</head>
<body style="background-color: #606060;">
<h1>Dashboard</h1>
<div id="content"></div>
<button onclick="redirectToUpdate()">Update Information</button>

<script>
  function loadContent() {
    fetch('/api/users/current')
            .then(response => {
              if (!response.ok) {
                throw new Error('Failed to fetch current user details');
              }
              return response.json();
            })
            .then(user => {
              if (!user || !user.id || !user.role) {
                throw new Error('Invalid user details received');
              }

              let content = '';
                getMatchesByRole(user.role);
                content += '<h2>User Dashboard</h2>';

                getMatchesByRole()
                        .then(matches => {
                          content += matches;
                          content += '<button onClick="redirectToUpdateTitles()">Update Titles</button>';

                          document.getElementById('content').innerHTML = content;
                        })
                        .catch(error => {
                          console.error('Error fetching matches:', error.message);
                        });
            })
            .catch(error => {
              console.error('Error fetching current user details:', error);
            });
  }

  function redirectToUpdateTitles() {
    window.location.href = '/updateTitles.html';
  }


  function getMatchesByRole() {
    return fetch(`/api/users/byRole`)
            .then(response => response.json())
            .then(matches => {
              let content = '';
              if (matches.length > 0) {
                content += '<table border="1"><tr><th>ID</th><th>Tournament ID</th><th>Player 1 ID</th><th>Player 2 ID</th><th>Referee ID</th><th>Match Date</th><th>Score</th></tr>';
                matches.forEach(match => {
                  content += `<tr>
                      <td>${match.id}</td>
                      <td>${match.tournamentId}</td>
                      <td>${match.player1Id}</td>
                      <td>${match.player2Id}</td>
                      <td>${match.refereeId}</td>
                      <td>${match.matchDate}</td>
                      <td>${match.score}</td>
                    </tr>`;
                });
                content += '</table>';
              } else {
                content += '<p>No matches found.</p>';
              }
              return content;
            })
            .catch(error => {
              console.error('Error fetching matches:', error.message);
              return '<h2>Dashboard</h2><p>Error loading matches.</p>';
            });
  }

  function redirectToUpdate() {
    window.location.href = '/update.html';
  }


  window.onload = loadContent;
</script>
</body>
</html>
